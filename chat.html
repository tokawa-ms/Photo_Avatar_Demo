<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talking Avatar Chat Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="./css/styles.css" rel="stylesheet">
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <script defer src="./js/chat.js"></script>
</head>
<body class="min-h-screen bg-slate-100 text-slate-900">
  <div class="mx-auto flex max-w-7xl flex-col gap-6 px-4 py-6 lg:py-10">
    <header class="flex flex-col gap-2 lg:flex-row lg:items-end lg:justify-between">
      <div>
        <h1 class="text-3xl font-semibold text-slate-900">Talking Avatar Chat Demo</h1>
        <p class="text-sm text-slate-600">Azure Speech Avatar quickstart with conversational controls</p>
      </div>
    </header>

    <div class="grid gap-6 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]">
      <section class="flex flex-col gap-6">
        <div class="rounded-3xl border border-slate-200 bg-white/80 shadow-sm backdrop-blur">
          <div class="flex flex-col gap-4 p-6">
            <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
              <h2 class="text-xl font-semibold text-slate-900">Avatar Session</h2>
              <div class="flex flex-wrap gap-2">
                <button id="startSession" onclick="window.startSession()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-sky-600 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60">Open Avatar Session</button>
                <button id="microphone" onclick="window.microphone()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-emerald-600 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60" disabled>Start Microphone</button>
                <button id="stopSpeaking" onclick="stopSpeaking()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-amber-500 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-amber-600 disabled:cursor-not-allowed disabled:opacity-60" disabled>Stop Speaking</button>
                <button id="stopSession" onclick="window.stopSession()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-rose-600 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-rose-700 disabled:cursor-not-allowed disabled:opacity-60" disabled>Close Avatar Session</button>
              </div>
            </div>
            <div id="videoContainer" class="relative w-full overflow-hidden rounded-2xl bg-slate-900 shadow-inner">
              <div id="overlayArea" class="pointer-events-none absolute inset-0 z-20"></div>
              <div id="localVideo" class="h-full w-full" hidden>
                <video src="video/lisa-casual-sitting-idle.mp4" autoplay loop muted class="h-full w-full object-cover"></video>
              </div>
              <div id="remoteVideo" class="flex h-full w-full items-center justify-center"></div>
              <div id="subtitles" class="absolute bottom-6 left-4 right-4 z-30 hidden text-center text-xl font-semibold text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.45)]"></div>
            </div>
          </div>
        </div>

        <div id="configuration" class="rounded-3xl border border-slate-200 bg-white/80 shadow-sm backdrop-blur">
          <div class="flex flex-col gap-6 p-6">
            <h2 class="text-xl font-semibold text-slate-900">Configuration</h2>

            <section class="space-y-4">
              <h3 class="text-lg font-semibold text-slate-800">Azure Speech Resource</h3>
              <div id="azureSpeechResource" class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
                <div class="flex flex-col gap-2">
                  <label for="region" class="text-sm font-medium text-slate-700">Region</label>
                  <select id="region" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <option value="westus2">West US 2</option>
                    <option value="westeurope">West Europe</option>
                    <option value="southeastasia">Southeast Asia</option>
                    <option value="southcentralus">South Central US</option>
                    <option value="northeurope">North Europe</option>
                    <option value="swedencentral">Sweden Central</option>
                    <option value="eastus2">East US 2</option>
                  </select>
                </div>
                <div class="flex flex-col gap-2 sm:col-span-2 xl:col-span-2">
                  <label for="APIKey" class="text-sm font-medium text-slate-700">API Key</label>
                  <input id="APIKey" type="password" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
              </div>
              <div class="flex flex-wrap gap-4">
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="enablePrivateEndpoint" onchange="window.updatePrivateEndpoint()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Enable Private Endpoint</span>
                </label>
              </div>
              <div id="showPrivateEndpointCheckBox" class="grid gap-2 sm:max-w-xl" hidden="hidden">
                <label for="privateEndpoint" class="text-sm font-medium text-slate-700">Private Endpoint</label>
                <input id="privateEndpoint" type="text" placeholder="https://{your custom name}.cognitiveservices.azure.com/" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
              </div>
            </section>

            <section class="space-y-4">
              <h3 class="text-lg font-semibold text-slate-800">Azure OpenAI Resource</h3>
              <div class="grid gap-4 sm:grid-cols-2">
                <div class="flex flex-col gap-2 sm:col-span-2">
                  <label for="azureOpenAIEndpoint" class="text-sm font-medium text-slate-700">Endpoint</label>
                  <input id="azureOpenAIEndpoint" type="text" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="azureOpenAIApiKey" class="text-sm font-medium text-slate-700">API Key</label>
                  <input id="azureOpenAIApiKey" type="password" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="azureOpenAIDeploymentName" class="text-sm font-medium text-slate-700">Deployment Name</label>
                  <input id="azureOpenAIDeploymentName" type="text" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2 sm:col-span-2">
                  <label for="prompt" class="text-sm font-medium text-slate-700">System Prompt</label>
                  <textarea id="prompt" class="min-h-[120px] w-full rounded-xl border border-slate-300 bg-white px-3 py-3 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500">You are an AI assistant that helps people find information.</textarea>
                </div>
              </div>
              <label class="flex items-center gap-2 text-sm text-slate-600">
                <input type="checkbox" id="enableOyd" onchange="window.updataEnableOyd()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                <span>Enable On Your Data</span>
              </label>

              <div id="cogSearchConfig" class="grid gap-4 rounded-2xl border border-dashed border-slate-300 bg-slate-50/80 p-4" hidden="hidden">
                <h4 class="text-base font-semibold text-slate-800">Azure Cognitive Search Resource</h4>
                <div class="grid gap-4 sm:grid-cols-2">
                  <div class="flex flex-col gap-2 sm:col-span-2">
                    <label for="azureCogSearchEndpoint" class="text-sm font-medium text-slate-700">Endpoint</label>
                    <input id="azureCogSearchEndpoint" type="text" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                  </div>
                  <div class="flex flex-col gap-2">
                    <label for="azureCogSearchApiKey" class="text-sm font-medium text-slate-700">API Key</label>
                    <input id="azureCogSearchApiKey" type="password" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                  </div>
                  <div class="flex flex-col gap-2">
                    <label for="azureCogSearchIndexName" class="text-sm font-medium text-slate-700">Index Name</label>
                    <input id="azureCogSearchIndexName" type="text" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                  </div>
                </div>
              </div>
            </section>

            <section class="space-y-4">
              <h3 class="text-lg font-semibold text-slate-800">STT / TTS Configuration</h3>
              <div class="grid gap-4 sm:grid-cols-2">
                <div class="flex flex-col gap-2 sm:col-span-2">
                  <label for="sttLocales" class="text-sm font-medium text-slate-700">STT Locale(s)</label>
                  <input id="sttLocales" type="text" value="en-US,de-DE,es-ES,fr-FR,it-IT,ja-JP,ko-KR,zh-CN" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="ttsVoice" class="text-sm font-medium text-slate-700">TTS Voice</label>
                  <input id="ttsVoice" type="text" value="en-US-AvaMultilingualNeural" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="customVoiceEndpointId" class="text-sm font-medium text-slate-700">Custom Voice Deployment ID (Endpoint ID)</label>
                  <input id="customVoiceEndpointId" type="text" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
              </div>
              <label class="flex items-center gap-2 text-sm text-slate-600">
                <input type="checkbox" id="continuousConversation" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                <span>Continuous Conversation</span>
              </label>
            </section>

            <section class="space-y-4">
              <h3 class="text-lg font-semibold text-slate-800">Avatar Configuration</h3>
              <div class="grid gap-4 sm:grid-cols-2">
                <div class="flex flex-col gap-2">
                  <label for="talkingAvatarCharacter" class="text-sm font-medium text-slate-700">Avatar Character</label>
                  <input id="talkingAvatarCharacter" type="text" value="lisa" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                  <select id="photoAvatarCharacterSelect" aria-label="Photo Avatar Character" class="hidden w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <option value="adrian">Adrian</option>
                    <option value="amara">Amara</option>
                    <option value="amira">Amira</option>
                    <option value="anika" selected>Anika</option>
                    <option value="bianca">Bianca</option>
                    <option value="camila">Camila</option>
                    <option value="carlos">Carlos</option>
                    <option value="clara">Clara</option>
                    <option value="darius">Darius</option>
                    <option value="diego">Diego</option>
                    <option value="elise">Elise</option>
                    <option value="farhan">Farhan</option>
                    <option value="faris">Faris</option>
                    <option value="gabrielle">Gabrielle</option>
                    <option value="hyejin">Hyejin</option>
                    <option value="imran">Imran</option>
                    <option value="isabella">Isabella</option>
                    <option value="layla">Layla</option>
                    <option value="liwei">Liwei</option>
                    <option value="ling">Ling</option>
                    <option value="marcus">Marcus</option>
                    <option value="matteo">Matteo</option>
                    <option value="rahul">Rahul</option>
                    <option value="rana">Rana</option>
                    <option value="ren">Ren</option>
                    <option value="riya">Riya</option>
                    <option value="sakura">Sakura</option>
                    <option value="simone">Simone</option>
                    <option value="zayd">Zayd</option>
                    <option value="zoe">Zoe</option>
                  </select>
                </div>
                <div class="flex flex-col gap-2">
                  <label for="talkingAvatarStyle" class="text-sm font-medium text-slate-700">Avatar Style</label>
                  <input id="talkingAvatarStyle" type="text" value="casual-sitting" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
              </div>
              <div class="flex flex-wrap gap-4">
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="photoAvatar" onchange="window.updatePhotoAvatarBox()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Photo Avatar</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="customizedAvatar" onchange="window.updateCustomAvatarBox()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Custom Avatar</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="useBuiltInVoice" disabled class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Use Built-In Voice</span>
                </label>
              </div>
              <div class="flex flex-wrap gap-4">
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="autoReconnectAvatar" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Auto Reconnect</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="useLocalVideoForIdle" onchange="window.updateLocalVideoForIdle()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Use Local Video for Idle</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="showSubtitles" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Show Subtitles</span>
                </label>
              </div>
            </section>
          </div>
        </div>
      </section>

      <section class="flex h-full flex-col">
        <div class="flex h-full flex-col rounded-3xl border border-slate-200 bg-white/90 shadow-sm backdrop-blur">
          <div class="flex items-center justify-between gap-3 border-b border-slate-200 px-6 py-4">
            <h2 class="text-xl font-semibold text-slate-900">Conversation Timeline</h2>
            <button id="clearChatHistory" onclick="window.clearChatHistory()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-slate-200 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-slate-600 transition hover:!bg-slate-300">Clear History</button>
          </div>
          <div class="flex-1 overflow-y-auto scrollbar-thin px-6 py-6">
            <div id="chatHistory" class="flex flex-col gap-4" hidden></div>
            <p id="chatHistoryPlaceholder" class="text-sm text-slate-500">
              Start an avatar session to see the conversation timeline here.
            </p>
          </div>
          <div class="space-y-4 border-t border-slate-200 px-6 py-4">
            <div id="showTypeMessageCheckbox" class="flex items-center gap-2 text-sm text-slate-600">
              <input type="checkbox" id="showTypeMessage" onchange="window.updateTypeMessageBox()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" disabled />
              <label for="showTypeMessage" class="select-none">Type Message</label>
            </div>
            <div id="userMessageBox" class="scrollbar-thin max-h-[220px] min-h-[90px] w-full overflow-y-auto rounded-2xl border border-slate-200 bg-white p-3 text-sm leading-relaxed text-slate-900 shadow-inner focus:outline-none" hidden contentEditable="true"></div>
            <div class="flex items-center justify-between">
              <img id="uploadImgIcon" src="./image/attachment.jpg" alt="Attach" class="h-10 w-10 cursor-pointer rounded-full border border-slate-200 object-cover shadow-sm" hidden />
              <span class="text-xs text-slate-400">Press Enter to send messages.</span>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</body>
</html>