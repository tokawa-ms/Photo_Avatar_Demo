<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talking Avatar Service Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="./css/styles.css" rel="stylesheet">
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <script defer src="./js/basic.js"></script>
</head>
<body class="min-h-screen bg-slate-100 text-slate-900">
  <div class="mx-auto flex max-w-7xl flex-col gap-6 px-4 py-6 lg:py-10">
    <header class="flex flex-col gap-2 lg:flex-row lg:items-end lg:justify-between">
      <div>
        <h1 class="text-3xl font-semibold text-slate-900">Talking Avatar Service Demo</h1>
        <p class="text-sm text-slate-600">Enter text, stream logs, and drive the avatar session.</p>
      </div>
    </header>

    <div class="grid gap-6 lg:grid-cols-[minmax(0,1.2fr)_minmax(0,1fr)]">
      <section class="flex flex-col gap-6">
        <div class="rounded-3xl border border-slate-200 bg-white/80 shadow-sm backdrop-blur">
          <div class="flex flex-col gap-4 p-6">
            <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between">
              <h2 class="text-xl font-semibold text-slate-900">Avatar Session</h2>
              <div class="flex flex-wrap gap-2">
                <button id="startSession" onclick="window.startSession()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-sky-600 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-sky-700 disabled:cursor-not-allowed disabled:opacity-60">Start Session</button>
                <button id="stopSession" onclick="window.stopSession()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-rose-600 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-rose-700 disabled:cursor-not-allowed disabled:opacity-60" disabled>Stop Session</button>
              </div>
            </div>

            <div class="space-y-3">
              <h3 id="videoLabel" class="text-sm font-semibold uppercase tracking-wide text-slate-500">Avatar Video</h3>
              <div id="videoContainer" class="relative w-full overflow-hidden rounded-2xl bg-slate-900 shadow-inner">
                <div id="overlayArea" class="pointer-events-none absolute inset-0 z-20" hidden>
                  <p id="overlayText" class="px-4 py-2 text-sm font-semibold text-white drop-shadow">Live Video</p>
                </div>
                <div id="remoteVideo" class="flex h-full w-full items-center justify-center"></div>
                <div id="subtitles" class="absolute bottom-6 left-4 right-4 z-30 text-center text-xl font-semibold text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.45)]" hidden></div>
                <canvas id="canvas" max-width="1920" height="1080" class="bg-transparent" hidden></canvas>
                <canvas id="tmpCanvas" max-width="1920" height="1080" hidden></canvas>
              </div>
            </div>
          </div>
        </div>

        <div id="configuration" class="rounded-3xl border border-slate-200 bg-white/80 shadow-sm backdrop-blur">
          <div class="flex flex-col gap-6 p-6">
            <h2 class="text-xl font-semibold text-slate-900">Configuration</h2>

            <section class="space-y-4">
              <h3 class="text-lg font-semibold text-slate-800">Azure Speech Resource</h3>
              <div id="azureSpeechResource" class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
                <div class="flex flex-col gap-2">
                  <label for="region" class="text-sm font-medium text-slate-700">Region</label>
                  <select id="region" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500">
                    <option value="westus2">West US 2</option>
                    <option value="westeurope">West Europe</option>
                    <option value="southeastasia">Southeast Asia</option>
                    <option value="southcentralus">South Central US</option>
                    <option value="northeurope">North Europe</option>
                    <option value="swedencentral">Sweden Central</option>
                    <option value="eastus2">East US 2</option>
                  </select>
                </div>
                <div class="flex flex-col gap-2 sm:col-span-2 xl:col-span-2">
                  <label for="APIKey" class="text-sm font-medium text-slate-700">API Key</label>
                  <input id="APIKey" type="password" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
              </div>
              <label class="flex items-center gap-2 text-sm text-slate-600">
                <input type="checkbox" id="enablePrivateEndpoint" onchange="window.updatePrivateEndpoint()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                <span>Enable Private Endpoint</span>
              </label>
              <div id="showPrivateEndpointCheckBox" class="grid gap-2 sm:max-w-xl" hidden="hidden">
                <label for="privateEndpoint" class="text-sm font-medium text-slate-700">Private Endpoint</label>
                <input id="privateEndpoint" type="text" placeholder="https://{your custom name}.cognitiveservices.azure.com/" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
              </div>
            </section>

            <section class="space-y-4">
              <h3 class="text-lg font-semibold text-slate-800">TTS Configuration</h3>
              <div class="grid gap-4 sm:grid-cols-2">
                <div class="flex flex-col gap-2">
                  <label for="ttsVoice" class="text-sm font-medium text-slate-700">TTS Voice</label>
                  <input id="ttsVoice" type="text" value="en-US-AvaMultilingualNeural" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="customVoiceEndpointId" class="text-sm font-medium text-slate-700">Custom Voice Deployment ID (Endpoint ID)</label>
                  <input id="customVoiceEndpointId" type="text" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
              </div>
            </section>

            <section class="space-y-4">
              <h3 class="text-lg font-semibold text-slate-800">Avatar Configuration</h3>
              <div class="grid gap-4 sm:grid-cols-2">
                <div class="flex flex-col gap-2">
                  <label for="talkingAvatarCharacter" class="text-sm font-medium text-slate-700">Avatar Character</label>
                  <input id="talkingAvatarCharacter" type="text" value="lisa" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="talkingAvatarStyle" class="text-sm font-medium text-slate-700">Avatar Style</label>
                  <input id="talkingAvatarStyle" type="text" value="casual-sitting" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2">
                  <label for="backgroundColor" class="text-sm font-medium text-slate-700">Background Color</label>
                  <input id="backgroundColor" type="text" value="#FFFFFFFF" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
                <div class="flex flex-col gap-2 sm:col-span-2">
                  <label for="backgroundImageUrl" class="text-sm font-medium text-slate-700">Background Image (URL)</label>
                  <input id="backgroundImageUrl" type="text" placeholder="https://www.example.com/1920-1080-image.jpg" class="w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-transparent focus:outline-none focus:ring-2 focus:ring-sky-500" />
                </div>
              </div>
              <div class="flex flex-wrap gap-4">
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="photoAvatar" onchange="window.updatePhotoAvatarBox()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Photo Avatar</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="customizedAvatar" onchange="window.updateCustomAvatarBox()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Custom Avatar</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="useBuiltInVoice" disabled class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Use Built-In Voice</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="transparentBackground" onchange="window.updataTransparentBackground()" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Transparent Background</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="videoCrop" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Video Crop</span>
                </label>
                <label class="flex items-center gap-2 text-sm text-slate-600">
                  <input type="checkbox" id="showSubtitles" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" />
                  <span>Show Subtitles</span>
                </label>
              </div>
            </section>
          </div>
        </div>
      </section>

      <section class="flex h-full flex-col">
        <div class="flex h-full flex-col rounded-3xl border border-slate-200 bg-white/90 shadow-sm backdrop-blur">
          <div class="flex flex-col gap-4 px-6 py-6">
            <div class="flex flex-col gap-2">
              <h2 class="text-xl font-semibold text-slate-900">Speech Console</h2>
              <p class="text-xs text-slate-500">Enter text to speak and watch logs stream in real time.</p>
            </div>
            <div class="space-y-3">
              <label for="spokenText" class="text-sm font-medium text-slate-700">Spoken Text</label>
              <textarea id="spokenText" class="min-h-[120px] w-full rounded-2xl border border-slate-200 bg-white p-3 text-sm leading-relaxed text-slate-900 shadow-inner focus:outline-none">Hello world!</textarea>
              <div class="flex flex-wrap gap-2">
                <button id="speak" onclick="window.speak()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-emerald-600 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60" disabled>Speak</button>
                <button id="stopSpeaking" onclick="window.stopSpeaking()" class="inline-flex items-center justify-center rounded-full border border-transparent !bg-amber-500 px-4 py-2 text-sm font-medium !text-white shadow-sm transition hover:!bg-amber-600 disabled:cursor-not-allowed disabled:opacity-60" disabled>Stop Speaking</button>
              </div>
            </div>
          </div>
          <div class="flex flex-1 flex-col border-t border-slate-200 px-6 py-6">
            <div class="mb-4 flex flex-wrap items-center gap-3 text-xs text-slate-500">
              <span class="text-sm font-semibold text-slate-700">Log Filters</span>
              <label class="flex items-center gap-1">
                <input type="checkbox" id="logFilter-all" class="h-4 w-4 rounded border-slate-300 text-slate-600 focus:ring-slate-500" checked>
                <span>All</span>
              </label>
              <label class="flex items-center gap-1">
                <input type="checkbox" id="logFilter-info" class="h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500" checked>
                <span>Info</span>
              </label>
              <label class="flex items-center gap-1">
                <input type="checkbox" id="logFilter-warn" class="h-4 w-4 rounded border-slate-300 text-amber-500 focus:ring-amber-500" checked>
                <span>Warn</span>
              </label>
              <label class="flex items-center gap-1">
                <input type="checkbox" id="logFilter-error" class="h-4 w-4 rounded border-slate-300 text-rose-600 focus:ring-rose-500" checked>
                <span>Error</span>
              </label>
            </div>
            <div class="scrollbar-thin flex-1 overflow-y-auto">
              <div id="logging" class="flex flex-col gap-2" hidden></div>
              <p id="logPlaceholder" class="text-sm text-slate-500">Session and synthesis logs will appear here.</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</body>
</html>
